(this.webpackJsonpdoctored2=this.webpackJsonpdoctored2||[]).push([[0],{13:function(t,e,a){"use strict";(function(t,n){a.d(e,"a",(function(){return d}));var r=a(7),s=a.n(r),i=a(2),c=a(4),o=a(3),h=a(5),u=a(1),l=a(8);function d(){var e,a="";function r(){return(r=Object(l.a)(s.a.mark((function t(a,n){var r,i,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("initSax"),r=new URL("./sax-wasm.wasm",n.location).toString(),e=new k(f.Attribute|f.OpenTag,{highWaterMark:1048576}),t.next=5,fetch(r);case 5:return i=t.sent,t.next=8,i.arrayBuffer();case 8:return c=t.sent,t.next=11,e.prepareWasm(new Uint8Array(c));case 11:t.sent?(e.eventHandler=function(t,e){},a.postMessage({type:"sax-ready"})):a.postMessage({type:"sax-failure",reason:"Unable to parser.prepareWasm"});case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(){return(d=Object(l.a)(s.a.mark((function t(n,r){var i,c,o,h,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Loading...",r.url),t.prev=1,t.next=4,fetch(r.url);case 4:if(i=t.sent,c=parseInt(i.headers.get("Content-Length")||"-1",10),n.postMessage({type:"loading",url:r.url,contentLengthBytes:c,loadedLengthString:0}),i&&i.body){t.next=9;break}throw Error("Fetch error. Response type = "+typeof i);case 9:o=0,h=i.body.getReader();case 11:return t.next=14,h.read();case 14:if(!(u=t.sent).done){t.next=18;break}return e.end(),t.abrupt("break",23);case 18:e.write(u.value),o+=u.value?u.value.length:0,n.postMessage({type:"loading",url:r.url,contentLengthBytes:c,loadedLengthBytes:o,loadedLengthString:a.length}),t.next=11;break;case 23:n.postMessage({type:"loaded",url:r.url,contentLengthBytes:c,loadedLengthBytes:o,loadedLengthString:a.length}),t.next=29;break;case 26:t.prev=26,t.t0=t.catch(1),console.log("fetch load error",t.t0);case 29:case"end":return t.stop()}}),t,null,[[1,26]])})))).apply(this,arguments)}self.onmessage=function(t){var e=t.data;switch(e.type){case"init-sax":!function(t,e){r.apply(this,arguments)}(self,e);break;case"load-source":!function(t,e){d.apply(this,arguments)}(self,e);break;case"cancel":break;default:throw Error("Unrecognised message ".concat(JSON.stringify(e)))}};var f=function t(){Object(u.a)(this,t)};f.Text=1,f.ProcessingInstruction=2,f.SGMLDeclaration=4,f.Doctype=8,f.Comment=16,f.OpenTagStart=32,f.Attribute=64,f.OpenTag=128,f.CloseTag=256,f.OpenCDATA=512,f.Cdata=1024,f.CloseCDATA=2048;var p=function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(u.a)(this,t),this.data=void 0,this.cache={},this.ptr=void 0,this.data=e,this.ptr=a},v=function t(e,a){Object(u.a)(this,t),this.line=void 0,this.character=void 0,this.line=e,this.character=a},g=function(t){function e(){return Object(u.a)(this,e),Object(c.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(h.a)(e,t),Object(i.a)(e,[{key:"toJSON",value:function(){return{nameStart:this.nameStart,nameEnd:this.nameEnd,valueStart:this.valueStart,valueEnd:this.valueEnd,name:this.name,value:this.value}}},{key:"nameStart",get:function(){return this.cache.nameStart||(this.cache.nameStart=S(this.data,this.ptr))}},{key:"nameEnd",get:function(){return this.cache.nameEnd||(this.cache.nameEnd=S(this.data,this.ptr+8))}},{key:"valueStart",get:function(){return this.cache.valueStart||(this.cache.valueStart=S(this.data,this.ptr+16))}},{key:"valueEnd",get:function(){return this.cache.valueEnd||(this.cache.valueEnd=S(this.data,this.ptr+24))}},{key:"name",get:function(){if(this.cache.name)return this.cache.name;var t=O(this.data,this.ptr+32);return this.cache.name=w(this.data.buffer,this.ptr+36,t)}},{key:"value",get:function(){if(this.cache.value)return this.cache.value;var t=O(this.data,this.ptr+32),e=O(this.data,this.ptr+36+t);return this.cache.value=w(this.data.buffer,this.ptr+40+t,e)}}]),e}(p),b=function(t){function e(){return Object(u.a)(this,e),Object(c.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(h.a)(e,t),Object(i.a)(e,[{key:"toJSON",value:function(){return{start:this.start,end:this.end,value:this.value}}},{key:"start",get:function(){return this.cache.start||(this.cache.start=S(this.data,this.ptr))}},{key:"end",get:function(){return this.cache.end||(this.cache.end=S(this.data,this.ptr+8))}},{key:"value",get:function(){if(this.cache.value)return this.cache.value;var t=O(this.data,this.ptr+16);return this.cache.value=w(this.data.buffer,this.ptr+20,t)}}]),e}(p),y=function(t){function e(){return Object(u.a)(this,e),Object(c.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(h.a)(e,t),Object(i.a)(e,[{key:"toJSON",value:function(){return{value:this.value}}},{key:"toString",value:function(){return this.value}},{key:"value",get:function(){return this.cache.value?this.cache.value:this.cache.value=w(this.data.buffer,this.ptr,this.data.length)}}]),e}(p),m=function(t){function e(){return Object(u.a)(this,e),Object(c.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(h.a)(e,t),Object(i.a)(e,[{key:"toJSON",value:function(){return{openStart:this.openStart,openEnd:this.openEnd,closeStart:this.closeStart,closeEnd:this.closeEnd,name:this.name,attributes:this.attributes,textNodes:this.textNodes,selfClosing:this.selfClosing}}},{key:"openStart",get:function(){return this.cache.openStart||(this.cache.openStart=S(this.data,0))}},{key:"openEnd",get:function(){return this.cache.openEnd||(this.cache.openEnd=S(this.data,8))}},{key:"closeStart",get:function(){return this.cache.closeStart||(this.cache.closeStart=S(this.data,16))}},{key:"closeEnd",get:function(){return this.cache.closeEnd||(this.cache.closeEnd=S(this.data,24))}},{key:"selfClosing",get:function(){return!!this.data[32]}},{key:"name",get:function(){if(this.cache.name)return this.cache.name;var t=O(this.data,33);return this.cache.name=w(this.data.buffer,37,t)}},{key:"attributes",get:function(){if(this.cache.attributes)return this.cache.attributes;var t=O(this.data,this.data.length-8),e=O(this.data,t);t+=4;for(var a=[],n=0;n<e;n++){var r=O(this.data,t);t+=4,a[n]=new g(this.data,t),t+=r}return this.cache.attributes=a}},{key:"textNodes",get:function(){if(this.cache.textNodes)return this.cache.textNodes;var t=O(this.data,this.data.length-4),e=O(this.data,t),a=[];t+=4;for(var n=0;n<e;n++){var r=O(this.data,t);t+=4,a[n]=new b(this.data,t),t+=r}return this.cache.textNodes=a}},{key:"value",get:function(){return this.name}}]),e}(p),k=function(){function t(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{highWaterMark:32768};Object(u.a)(this,t),this.events=void 0,this.eventHandler=void 0,this.options=void 0,this.wasmSaxParser=void 0,this.writeBuffer=void 0,this.eventTrap=function(t,a,n){var r,s=new Uint8Array(e.wasmSaxParser.memory.buffer.slice(a,a+n));switch(t){case f.Attribute:r=new g(s);break;case f.OpenTag:case f.CloseTag:case f.OpenTagStart:r=new m(s);break;case f.Text:r=new b(s);break;case f.OpenCDATA:r=S(s);break;default:r=new y(s)}e.eventHandler(t,r)},this.options=n;var r=this;Object.defineProperties(this,{events:{get:function(){return~~a},set:function(t){a=~~t,r.wasmSaxParser&&r.wasmSaxParser.parser(a)},configurable:!1,enumerable:!0}})}return Object(i.a)(t,[{key:"write",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=this.wasmSaxParser,n=a.write,r=a.memory.buffer;this.writeBuffer&&this.writeBuffer.buffer===r||(this.writeBuffer=new Uint8Array(r,0,this.options.highWaterMark)),this.writeBuffer.set(t),n(e,t.byteLength)}},{key:"end",value:function(){this.writeBuffer=null,this.wasmSaxParser.end()}},{key:"prepareWasm",value:function(){var t=Object(l.a)(s.a.mark((function t(e){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,WebAssembly.instantiate(e,{env:{memoryBase:0,tableBase:0,memory:new WebAssembly.Memory({initial:32}),table:new WebAssembly.Table({initial:1,element:"anyfunc"}),event_listener:this.eventTrap}});case 2:if(!(a=t.sent)){t.next=7;break}return n=this.wasmSaxParser=a.instance.exports,(0,n.parser)(this.events),t.abrupt("return",!0);case 7:throw new Error("Failed to instantiate the parser.");case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}();function w(e,a,r){return void 0!==(t||window).Buffer?n.from(e,a,r).toString():(k.textDecoder||(k.textDecoder=new TextDecoder)).decode(new Uint8Array(e,a,r))}function O(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function S(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=O(t,e),n=O(t,e+4);return new v(a,n)}k.textDecoder=void 0}}).call(this,a(11),a(19).Buffer)},14:function(t,e,a){t.exports=a(24)},24:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),s=a(12),i=a.n(s),c=a(1),o=a(2),h=a(4),u=a(3),l=a(6),d=a(5),f=(a(9),a(13));var p=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(u.a)(e).call(this,t))).sourceWorker=void 0,a.state={},a.sourceWorkerInit=a.sourceWorkerInit.bind(Object(l.a)(a)),a.sourceWorkerInit(),a}return Object(d.a)(e,t),Object(o.a)(e,[{key:"sourceWorkerInit",value:function(){this.onmessage=this.onmessage.bind(this),this.sourceWorker=function(t){var e=function(t){var e=t.indexOf("{")+1,a=t.lastIndexOf("}");return t.substring(e,a)}(t.toString()),a=new Blob([e],{type:"text/javascript"}),n=window.URL.createObjectURL(a);return new Worker(n)}(f.a),this.sourceWorker.onmessage=this.onmessage,this.sourceWorker.postMessage({type:"init-sax",location:window.location.toString()})}},{key:"onmessage",value:function(t){var e=t.data;console.log("UI Thread Received: ",e),"sax-ready"===e.type&&this.sourceWorker.postMessage({type:"load-source",url:new URL("./large.xml",window.location.toString()).toString()}),"loading"===e.type&&this.setState({loading:e}),"loaded"===e.type&&this.setState({loaded:e})}},{key:"render",value:function(){var t=this.state,e=t.loaded,a=t.loading;return r.a.createElement("div",null,r.a.createElement("p",null,"Loading and parsing an 80MB XML file in a background thread using WASM."),r.a.createElement("p",null,"Open your dev console to see messages between threads."),r.a.createElement("div",null,a&&a.loadedLengthBytes),r.a.createElement("div",null,e&&"DONE"))}}]),e}(n.Component);i.a.render(r.a.createElement(p,null),document.getElementById("root"))}},[[14,1,2]]]);
//# sourceMappingURL=main.ed374cd9.chunk.js.map